<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>PenOC Admin</title>
    <style>
        body{
            font-family:'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;
        }
        .field-label {
            font-weight:700;
        }
        textarea{
            height:200px;
            width:600px;
            vertical-align:text-top;
        }
    </style>
</head>
<body>


    <div id="divEvent">
        <h2>Search by Event ID</h2>
        <span>ID:</span><input type="text" id="eventID" size="5" />
        <input type="button" value="Search" onclick="find();" /><br />
        <div id="divEventDetails" style="border:1px solid grey">
            <span class="field-label">ID:</span><br /><input type="text" id="txtId"></input><br />
            <span class="field-label">Name:</span><br /><input type="text" id="txtName"></input><br />
            <span class="field-label">Date:</span><br /><input type="text" id="txtDate"></input><br />
            <span class="field-label">Venue:</span><br /><select id="lstVenue"></select><br />
            <span class="field-label">Planner:</span><br /><select id="lstPlanner"></select><br />
            <span class="field-label">Controller:</span><br /><select id="lstController"></select><br />
            <span class="field-label">Registration:</span><br /><textarea id="txtRegistration"></textarea><br />
            <span class="field-label">Starts:</span><br /><textarea id="txtStart"></textarea><br />
            <span class="field-label">Courses Close:</span><br /><textarea id="txtClose"></textarea><br />
            <span class="field-label">Cost:</span><br /><textarea id="txtCost"></textarea><br />
            <span class="field-label">Special Note:</span><br /><textarea id="txtSpecialNote"></textarea><br />
            <span class="field-label">Latitude:</span><br /><input type="text" id="txtLatitude"></textarea><br />
            <span class="field-label">Longitude:</span><br /><input type="text" id="txtLongitude"></textarea><br />

        </div>
        <input type="button" id="btnUpdate" value="Update" onclick="updateEvent();" />
        <input type="button" id="btnCreate" value="Create" onclick="createOEvent();" />
    </div>


    <script src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-2.0.3.min.js"></script>
    <script>
        var uri = '../api';

        $(document).ready(function () {
            populateForm();
        });

        function find() {
            var id = $('#eventID').val();
            $.getJSON(uri + '/OEvents/' + id)
                .done(function (data) {
                    populateFromEvent(data[0]);
                })
                .fail(function (jqXHR, textStatus, err) {
                    $('#product').text('Error: ' + err);
                });
        }

        function populateFromEvent(oEvent) {
            $('#txtId').val(oEvent.id);
            $('#txtDate').val(oEvent.date);
            $('#txtName').val(oEvent.name);
            $('#lstVenue').val(oEvent.venueId);
            $('#txtCourses').val(oEvent.courses);
            $('#lstPlanner').val(oEvent.plannerId);
            $('#lstController').val(oEvent.controllerId);
            $('#txtRegistration').val(oEvent.registrationTime);
            $('#txtStart').val(oEvent.startTime);
            $('#txtClose').val(oEvent.close);
            $('#txtSpecialNote').val(oEvent.specialNote);
            $('#txtLatitude').val(oEvent.coordinateLatitude);
            $('#txtLongitude').val(oEvent.coordinateLongitude);
            $('#txtCost').val(oEvent.cost);

        }

        function constructEvent() {
            var oEvent = {};

            oEvent.id = $('#txtId').val();
            oEvent.date = $('#txtDate').val();
            oEvent.name = $('#txtName').val();
            oEvent.venueId = $('#lstVenue').val();
            oEvent.courses = $('#txtCourses').val();
            oEvent.plannerId = $('#lstPlanner').val();
            oEvent.controllerId = $('#lstController').val();
            oEvent.registrationTime = $('#txtRegistration').val();
            oEvent.startTime = $('#txtStart').val();
            oEvent.close = $('#txtClose').val();
            oEvent.specialNote = $('#txtSpecialNote').val();
            oEvent.coordinateLatitude = $('#txtLatitude').val();
            oEvent.coordinateLongitude = $('#txtLongitude').val();
            oEvent.cost = $('#txtCost').val();

            return oEvent;
        }

        function updateEvent() {

            var oEvent = constructEvent();

            $.ajax({
                type: "PUT",
                data: JSON.stringify(oEvent),
                url: uri + '/OEvents',
                contentType: "application/json"
            }).done(function (data) {
                populateFromEvent(data);
            });
        }

        function createOEvent() {

            var oEvent = constructEvent();

            $.ajax({
                type: "POST",
                data: JSON.stringify(oEvent),
                url: uri + '/OEvents',
                contentType: "application/json"
            }).done(function (data) {
                populateFromEvent(data);
            });
        }

        function populateForm() {
            populateVenues();
            populatePlanners();
            populateControllers();
        }

        function populateVenues() {
            $.get(uri + '/Venues', null, function (data) {

                $.each(data, function (i, d) {
                    $('#lstVenue').append('<option value="' + d.id + '">' + d.name + '</option>');
                });
            });
        }

        function populatePlanners() {
            $.get(uri + '/Competitors/Individuals', null, function (data) {

                $.each(data, function (i, d) {
                    $('#lstPlanner').append('<option value="' + d.id + '">' + d.fullName + '</option>');
                });
            });
        }

        function populateControllers() {
            $.get(uri + '/Competitors/Individuals', null, function (data) {

                $.each(data, function (i, d) {
                    $('#lstController').append('<option value="' + d.id + '">' + d.fullName + '</option>');
                });
            });
        }

    </script>
</body>









</html>