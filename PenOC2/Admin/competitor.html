<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>PenOC Admin</title>
    <style>
        body {
            font-family: 'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;
        }

        .field-label {
            font-weight: 700;
        }

        textarea {
            height: 200px;
            width: 600px;
            vertical-align: text-top;
        }
    </style>
</head>
<body>


    <div id="divCompetitor">
        <h2>Search by Competitor ID</h2>
        <span>ID:</span><input type="text" id="competitorID" size="5" />
        <input type="button" value="Search" onclick="find();" /><br />
        <div id="divCompetitorDetails" style="border:1px solid grey">
            <span class="field-label">Competitor ID:</span><br /><input type="text" id="txtId"></input><br />
            <span class="field-label">First Name:</span><br /><input type="text" id="txtFirstName"></input><br />
            <span class="field-label">Surname:</span><br /><input type="text" id="txtSurname"></input><br />
            <span class="field-label">Gender:</span><br /><select id="lstGender"></select><br />
            <span class="field-label">Category:</span><br /><select id="lstCategory"></select><br />
            <span class="field-label">Email:</span><br /><input type="text" id="txtEmail"></input><br />
            <span class="field-label">Emit Number:</span><br /><input type="text" id="txtEmitNumber"></input><br />
            <span class="field-label">Telephone 1:</span><br /><input type="text" id="txtTelephone1"></input><br />
            <span class="field-label">Telephone 2:</span><br /><input type="text" id="txtTelephone2"></input><br />
        </div>
        <input type="button" id="btnUpdate" value="Update" onclick="updateCompetitor();" />
        <input type="button" id="btnCreate" value="Create" onclick="createCompetitor();" />
    </div>

    <script src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-2.0.3.min.js"></script>
    <script>
        var uri = '../api';

        $(document).ready(function () {
            populateForm();
        });

        function find() {
            var id = $('#competitorID').val();
            $.getJSON(uri + '/Competitors/' + id)
                .done(function (data) {
                    populateFromCompetitor(data[0]);
                })
                .fail(function (jqXHR, textStatus, err) {
                    $('#product').text('Error: ' + err);
                });
        }

        function populateFromCompetitor(competitor) {
            $('#txtId').val(competitor.id);
            $('#txtFirstName').val(competitor.firstName);
            $('#txtSurname').val(competitor.surname);
            $('#lstGender').val(competitor.genderId);
            $('#lstCategory').val(competitor.categoryId);
            $('#txtEmitNumber').val(competitor.emitNumber);
            $('#txtEmail').val(competitor.email);
            $('#txtTelephone1').val(competitor.telephone1);
            $('#txtTelephone2').val(competitor.telephone2);
        }

        function constructCompetitor() {
            var competitor = {};

            competitor.id = $('#txtId').val();
            competitor.firstName = $('#txtFirstName').val();
            competitor.surname = $('#txtSurname').val();
            competitor.genderId = $('#lstGender').val();
            competitor.categoryId = $('#lstCategory').val();
            competitor.emitNumber = $('#txtEmitNumber').val();
            competitor.email = $('#txtEmail').val();
            competitor.telephone1 = $('#txtTelephone1').val();
            competitor.telephone2 = $('#txtTelephone2').val();

            return competitor;
        }

        function updateCompetitor() {

            var competitor = constructCompetitor();

            $.ajax({
                type: "PUT",
                data: JSON.stringify(competitor),
                url: uri + '/Competitors',
                contentType: "application/json"
            }).done(function (data) {
                populateFromCompetitor(data[0]);
            });
        }

        function createCompetitor() {

            var oEvent = constructCompetitor();

            $.ajax({
                type: "POST",
                data: JSON.stringify(oEvent),
                url: uri + '/Competitors',
                contentType: "application/json"
            });
        }

        function populateForm() {
            populateGenders();
            populateCategories();
        }

        function populateGenders() {
            $.get(uri + '/Genders', null, function (data) {

                $.each(data, function (i, d) {
                    $('#lstGender').append('<option value="' + d.id + '">' + d.name + '</option>');
                });
            });
        }

        function populateCategories() {
            $.get(uri + '/Categories', null, function (data) {

                $.each(data, function (i, d) {
                    $('#lstCategory').append('<option value="' + d.id + '">' + d.name + '</option>');
                });
            });
        }

    </script>
</body>

</html>