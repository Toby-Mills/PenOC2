<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>PenOC Admin</title>
    <style>
        body {
            font-family: 'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;
        }

        .field-label {
            font-weight: 700;
        }

        textarea {
            height: 200px;
            width: 600px;
            vertical-align: text-top;
        }
    </style>
</head>
<body>


    <div id="divResult">
        <h2>Search by Course & Competitor ID</h2>
        <span>Course ID:</span><input type="text" id="courseID" size="5" /><br />
        <span>Competitor ID:</span><input type="text" id="competitorID" size="5" /><br />
        <input type="button" value="Search" onclick="find();" /><br />
        <div id="divResultDetails" style="border:1px solid grey">
            <span class="field-label">Course ID:</span><br /><input type="text" id="txtCourseId"></input><br />
            <span class="field-label">Competitor ID:</span><br /><input type="text" id="txtCompetitorId"></input><br />
            <span class="field-label">Position:</span><br /><input type="text" id="txtPosition"></input><br />
            <span class="field-label">Time:</span><br /><input type="text" id="txtTime"></input><br />
            <span class="field-label">Category:</span><br /><select id="lstCategory"></select><br />
            <span class="field-label">Points:</span><br /><input type="text" id="txtPoints"></input><br />
            <span class="field-label">Club:</span><br /><select id="lstClub"></select><br />
            <span class="field-label">Race Number:</span><br /><input type="text" id="txtRaceNumber"></input><br />
            <span class="field-label">Comment:</span><br /><input type="text" id="txtComment"></input><br />
            <span class="field-label">Disqualified:</span><br /><input type="checkbox" id="chkDisqualified"></input><br />
        </div>
        <input type="button" id="btnUpdate" value="Update" onclick="updateResult();" />
        <input type="button" id="btnCreate" value="Create" onclick="createResult();" />
    </div>

    <script src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-2.0.3.min.js"></script>
    <script>
        var uri = '../api';

        $(document).ready(function () {
            populateForm();
        });

        function find() {
            var courseId = $('#courseID').val();
            var competitorId = $('#competitorID').val();

            $.getJSON(uri + '/Courses/' + courseId + '/Results/' + competitorId)
                .done(function (data) {
                    populateFromResult(data);
                })
                .fail(function (jqXHR, textStatus, err) {
                    $('#product').text('Error: ' + err);
                });
        }

        function populateFromResult(result) {
            $('#txtCourseId').val(result.courseId);
            $('#txtCompetitorId').val(result.competitorId);
            $('#txtPosition').val(result.position);
            $('#txtTime').val(result.time);
            $('#lstCategory').val(result.categoryId);
            $('#txtPoints').val(result.points);
            $('#lstClub').val(result.clubId);
            $('#txtRaceNumber').val(result.raceNumber);
            $('#txtComment').val(result.comment);
            $('#chkDisqualified').val(result.disqualified);
        }

        function constructResult() {
            var result = {};

            result.courseId = $('#txtCourseId').val();
            result.competitorId = $('#txtCompetitorId').val();
            result.position = $('#txtPosition').val();
            result.time = $('#txtTime').val();
            result.categoryId = $('#lstCategory').val();
            result.points = $('#txtPoints').val();
            result.clubId = $('#lstClub').val();
            result.raceNumber = $('#txtRaceNumber').val();
            result.comment = $('#txtComment').val();
            result.disqualified = $('#chkDisqualified').val();

            return result;
        }

        function updateResult() {

            var result = constructResult();

            $.ajax({
                type: "PUT",
                data: JSON.stringify(result),
                url: uri + '/Results',
                contentType: "application/json"
            }).done(function (data) {
                populateFromCourse(data);
            });
        }

        function createResult() {

            var result = constructResult();

            $.ajax({
                type: "POST",
                data: JSON.stringify(result),
                url: uri + '/Results',
                contentType: "application/json"
            });
        }

        function populateForm() {
            populateClubs();
            populateCategories();
        }

        function populateClubs() {
            $.get(uri + '/Clubs', null, function (data) {

                $.each(data, function (i, d) {
                    $('#lstClub').append('<option value="' + d.id + '">' + d.name + '</option>');
                });
            });
        }

            function populateCategories() {
                $.get(uri + '/Categories', null, function (data) {

                    $.each(data, function (i, d) {
                        $('#lstCategory').append('<option value="' + d.id + '">' + d.name + '</option>');
                    });
                });
        }
    </script>
</body>

</html>