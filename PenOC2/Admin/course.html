<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>PenOC Admin</title>
    <style>
        body {
            font-family: 'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;
        }

        .field-label {
            font-weight: 700;
        }

        textarea {
            height: 200px;
            width: 600px;
            vertical-align: text-top;
        }
    </style>
</head>
<body>


    <div id="divCourse">
        <h2>Search by Course ID</h2>
        <span>ID:</span><input type="text" id="courseID" size="5" />
        <input type="button" value="Search" onclick="find();" /><br />
        <div id="divCourseDetails" style="border:1px solid grey">
            <span class="field-label">Course ID:</span><br /><input type="text" id="txtId"></input><br />
            <span class="field-label">Event ID:</span><br /><input type="text" id="txtEventId"></input><br />
            <span class="field-label">List Order:</span><br /><input type="text" id="txtListOrder"></input><br />
            <span class="field-label">Name:</span><br /><input type="text" id="txtName"></input><br />
            <span class="field-label">Length:</span><br /><input type="text" id="txtLength"></input><br />
            <span class="field-label">Climb:</span><br /><input type="text" id="txtClimb"></input><br />
            <span class="field-label">Technical Difficulty:</span><br /><select id="lstTechnical"></select><br />
            <span class="field-label">Controls:</span><br /><input type="text" id="txtControls"></input><br />
        </div>
        <input type="button" id="btnUpdate" value="Update" onclick="updateCourse();" />
        <input type="button" id="btnCreate" value="Create" onclick="createCourse();" />
    </div>

    <script src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-2.0.3.min.js"></script>
    <script>
        var uri = '../api';

        $(document).ready(function () {
            populateForm();
        });

        function find() {
            var id = $('#courseID').val();
            $.getJSON(uri + '/Courses/' + id)
                .done(function (data) {
                    populateFromCourse(data[0]);
                })
                .fail(function (jqXHR, textStatus, err) {
                    $('#product').text('Error: ' + err);
                });
        }

        function populateFromCourse(course) {
            $('#txtId').val(course.id);
            $('#txtEventId').val(course.eventId);
            $('#txtListOrder').val(course.listOrder);
            $('#txtName').val(course.name);
            $('#txtLength').val(course.length);
            $('#txtClimb').val(course.climb);
            $('#lstTechnical').val(course.difficultyId);
            $('#txtControls').val(course.controls);
        }

        function constructCourse() {
            var course = {};

            course.id = $('#txtId').val();
            course.eventId = $('#txtEventId').val();
            course.listOrder = $('#txtListOrder').val();
            course.name = $('#txtName').val();
            course.length = $('#txtLength').val();
            course.climb = $('#txtClimb').val();
            course.difficultyId = $('#lstTechnical').val();
            course.controls = $('#txtControls').val();

            return course;
        }

        function updateCourse() {

            var course = constructCourse();

            $.ajax({
                type: "PUT",
                data: JSON.stringify(course),
                url: uri + '/Courses',
                contentType: "application/json"
            }).done(function (data) {
                populateFromCourse(data[0]);
            });
        }

        function createCourse() {

            var oEvent = constructourse();

            $.ajax({
                type: "POST",
                data: JSON.stringify(oEvent),
                url: uri + '/Courses',
                contentType: "application/json"
            });
        }

        function populateForm() {
            populateTechnicalDifficulty();
        }

        function populateTechnicalDifficulty() {
            $.get(uri + '/lookups/TechnicalDifficulties', null, function (data) {

                $.each(data, function (i, d) {
                    $('#lstTechnical').append('<option value="' + d.id + '">' + d.name + '</option>');
                });
            });
        }
    </script>
</body>

</html>